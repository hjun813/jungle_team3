{% extends "auth_base.html" %}

{% block title %}회원가입{% endblock %}

{% block auth_content %}
<form id="signup-form" action="/signup" method="POST" class="transition duration-300">
    <h2 class="text-2xl font-bold text-center text-gray-800 mb-8">회원가입</h2>

    <!-- Flash 메시지 표시 -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-4">
          {% for category, message in messages %}
            <p class="text-sm {% if category == 'error' %}text-red-500{% elif category == 'success' %}text-green-500{% endif %}">
              {{ message }}
            </p>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <!-- 이름 입력 -->
    <div class="mb-4">
        <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-2">이름</label>
        <input type="text" id="signup-name" name="user_name" value="{{ user_name if user_name else '' }}"
               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
               placeholder="이름을 입력하세요" required>
    </div>

    <!-- 아이디 입력 및 중복 확인 -->
    <div class="mb-4">
        <label for="signup-userid" class="block text-sm font-medium text-gray-700 mb-2">아이디</label>
        <div class="flex">
            <input type="text" id="signup-userid" name="user_id" value="{{ user_id if user_id else '' }}"
                   class="flex-2 px-4 py-3 m-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                   placeholder="아이디를 입력하세요" required>
            <button type="button" id="check-duplicate-btn"
                    class="flex-1 m-1 py-3 bg-orange-600 text-white rounded-lg font-medium hover:bg-orange-700 transition duration-300">
                중복확인
            </button>
        </div>
        <p id="duplicate-msg" class="text-sm mt-2"></p>
    </div>

    <!-- 비밀번호 입력 -->
    <div class="mb-4">
        <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-2">비밀번호</label>
        <input type="password" id="signup-password" name="user_password"
               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
               placeholder="비밀번호를 입력하세요" required>
    </div>

    <!-- 비밀번호 확인 -->
    <div class="mb-6">
        <label for="signup-confirm-password" class="block text-sm font-medium text-gray-700 mb-2">비밀번호 확인</label>
        <input type="password" id="signup-confirm-password"
               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
               placeholder="비밀번호를 다시 입력하세요" required>
    </div>

    <!-- 카카오톡 ID 입력 -->
    <div class="mb-6">
        <label for="signup-kakaoid" class="block text-sm font-medium text-gray-700 mb-2">카카오톡ID</label>
        <input type="text" id="signup-kakaoid" name="kakao_id" value="{{ kakao_id if kakao_id else '' }}"
               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent"
               placeholder="카카오톡ID를 입력하세요">
    </div>

    <!-- 회원가입 버튼 -->
    <div class="mb-6">
        <input type="submit" value="회원가입"
               class="w-full bg-orange-600 text-white py-3 rounded-lg font-medium hover:bg-orange-700 transition duration-300 cursor-pointer">
    </div>
</form>

<!-- 로그인 링크 -->
<div class="text-center text-gray-600">
    이미 계정이 있으신가요?
    <a href="/login" class="text-orange-600 font-medium hover:underline">로그인</a>
</div>

<!-- jQuery CDN (없다면 추가) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function(){
    $("#check-duplicate-btn").click(function(){
        var userId = $("#signup-userid").val();
        if(!userId){
            $("#duplicate-msg").text("아이디를 입력하세요.").css("color", "red");
            return;
        }
        $.ajax({
            type: "GET",
            url: "/checkduplicate",
            data: { user_id: userId },
            dataType: "json",
            success: function(response){
                if(response.result){
                    $("#duplicate-msg").text(response.message).css("color", "green");
                } else {
                    $("#duplicate-msg").text(response.message).css("color", "red");
                }
            },
            error: function(){
                $("#duplicate-msg").text("중복 확인 중 오류가 발생했습니다.").css("color", "red");
            }
        });
    });
});
</script>
{% endblock %}