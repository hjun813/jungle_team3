<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>해요일 게시글 작성 페이지</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 p-6">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-lg">
        <h2 class="text-2xl font-bold mb-4">게시글 작성</h2>

            <label class="block mb-2 font-medium">제목 (최대 30자)</label>
            <input type="text" id="post_title" class="w-full p-2 border rounded-lg mb-4" placeholder="제목을 입력하세요"
                maxlength="30">

            <label class="block mb-2 font-medium">게시글 유형</label>
            <select id="post_type" class="w-full p-2 border rounded-lg mb-4">
                <option>음식</option>
                <option>운동</option>
                <option>기타</option>
            </select>

            <label class="block mb-2 font-medium">활동 날짜</label>
            <input type="date" id="meet_date" class="w-full p-2 border rounded-lg mb-4">

            <label class="block mb-2 font-medium">모집 기간</label>
            <input type="date" id="due_date" class="w-full p-2 border rounded-lg mb-4">

            <label class="block mb-2 font-medium">모집 인원</label>
            <input type="number" id="capacity" class="w-full p-2 border rounded-lg mb-4" placeholder="모집 인원을 입력하세요">

            <label class="block mb-2 font-medium">세부 사항 (최대 50자)</label>
            <textarea id="details" class="w-full p-2 border rounded-lg mb-4 h-32" placeholder="세부 사항을 입력하세요"
                maxlength="50"></textarea>

            <button type="submit" onclick="validateForm(this)" class="w-full bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600">작성 완료</button>
    </div>

    <script>
        function validateForm(button) {
            event.preventDefault();
            let title = document.getElementById('post_title').value.trim();
            let postType = document.getElementById('post_type').value;
            let activityDate = document.getElementById('meet_date').value;
            let recruitmentDate = document.getElementById('due_date').value;
            let recruitmentCount = document.getElementById('capacity').value;
            let details = document.getElementById('details').value.trim();
            let today = new Date().toISOString().split('T')[0];

            if (!title) {
                alert('제목을 입력해야 합니다.');
                return false;
            }

            if (!activityDate || activityDate < today) {
                alert('활동 날짜 확인 후 다시 입력해 주세요.');
                return false;
            }

            if (recruitmentDate && recruitmentDate > activityDate) {
                alert('모집 기간은 활동 날짜보다 뒤에 있을 수 없습니다.');
                return false;
            }

            if (!recruitmentCount || recruitmentCount < 2) {
                alert('모집 인원은 2명 이상이어야 합니다.');
                return false;
            }

            runFunction(title, postType, activityDate, recruitmentDate, recruitmentCount, details);
            return true;
        }

        function runFunction(title, postType, activityDate, recruitmentDate, recruitmentCount, details) {

            $.ajax({
                type: "POST", // POST 방식으로 요청하겠다.
                url: "/posting", // /posting이이라는 url에 요청하겠다.
                data: { post_title: title, post_type: postType, meet_date: activityDate, due_date: recruitmentDate, capacity: recruitmentCount, content: details }, // 데이터를 주는 방법
                success: function (response) { // 성공하면
                    if (response["result"] == "success") {
                        alert("포스팅 성공!");
                        // 3. 성공 시 페이지 새로고침하기
                        window.location.reload();
                    } else {
                        alert("서버 오류!")
                    }
                }
            })
        }
    </script>
</body>

</html>
